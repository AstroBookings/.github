# AstroBookings: Entity-Relationship Diagram

> Timestamp: 2024-08-19 21:30:00 UTC

## Entities

1. `User`: Base entity for all system users. Contains common information such as access credentials and contact data.

2. `Traveler`: Specialization of User. Represents clients who make bookings for space travels.

3. `Agency`: Specialization of User. Represents space agencies that offer launches.

4. `Rocket`: Represents spacecraft owned by agencies. Includes details such as capacity and range.

5. `Launch`: Represents a scheduled space trip. Includes information such as date, destination, and price per seat.

6. `Booking`: Represents the reservation of seats on a specific launch made by a traveler.

7. `Invoice`: Represents charges generated for agencies for completed launches. Can be associated with one or more payments.

8. `Payment`: Represents payments made by agencies to settle issued invoices.

9. `Notification`: Represents messages sent to system users about various events.

10. `EntryLog`: Represents system activity logs, used for monitoring and auditing.

11. `JobQueue`: Represents pending tasks for data synchronization between different parts of the system.

> [!NOTE]
>
> > This diagram is a simplified version of the real system. There are refinements at implementation level.

## Relationships

1. User _(1 to 0 or 1)_ Traveler

   - `User` _can be a_ `Traveler`
   - `Traveler` _is a_ `User`

2. User _(1 to 0 or 1)_ Agency

   - `User` _can be an_ `Agency`
   - `Agency` _is a_ `User`

3. User _(1 to 0 or many)_ Notification

   - `User` _receives_ `Notification`
   - `Notification` _is sent to_ `User`

4. Traveler _(1 to 0 or many)_ Booking

   - `Traveler` _makes_ `Booking`
   - `Booking` _is made by_ `Traveler`

5. Agency _(1 to 0 or many)_ Rocket

   - `Agency` _owns_ `Rocket`
   - `Rocket` _is owned by_ `Agency`

6. Agency _(1 to 0 or many)_ Launch

   - `Agency` _schedules_ `Launch`
   - `Launch` _is scheduled by_ `Agency`

7. Agency _(1 to 0 or many)_ Invoice

   - `Agency` _is billed by_ `Invoice`
   - `Invoice` _bills_ `Agency`

8. Rocket _(1 to 0 or many)_ Launch

   - `Rocket` _is used in_ `Launch`
   - `Launch` _uses_ `Rocket`

9. Launch _(1 to 0 or many)_ Booking

   - `Launch` _has_ `Booking`
   - `Booking` _is for_ `Launch`

10. Launch _(1 to 0 or 1)_ Invoice

    - `Launch` _generates_ `Invoice`
    - `Invoice` _is generated by_ `Launch`

11. Invoice _(1 to 0 or many)_ Payment

    - `Invoice` _is paid by_ `Payment`
    - `Payment` _pays_ `Invoice`

## Entity-Relationship Diagram

> All **identifiers** are of type `string` to allow for flexibility and the database independence. Should be generated as UUIDs or similar (`snowflake` preferable) by the API.

```mermaid
erDiagram
    User {
        string id PK
        string email
        string password_hash
        string name
        enum role "traveler, agency, finance, it"
    }

    Traveler {
        string user_id PK,FK
        string contact_phone
        string contact_email
        string emergency_contact
        json travel_preferences
    }

    Agency {
        string user_id PK,FK
        string description
        string contact_info
        string contact_email
        string legal_name
        string legal_tax_id
        string legal_address
    }

    Rocket {
        string id PK
        string agency_id FK
        string name
        int capacity
        enum range "low_earth, moon, mars"
    }

    Launch {
        string id PK
        string agency_id FK
        string rocket_id FK
        datetime date
        string destination
        decimal price_per_seat
        enum status "scheduled, confirmed, launched, delayed, aborted"
    }

    Booking {
        string id PK
        string traveler_id FK
        string launch_id FK
        int number_of_seats
        decimal total_price
        enum status "pending, confirmed, canceled"
    }

    Invoice {
        string id PK
        string number
        string agency_id FK
        string launch_id FK
        decimal amount
        datetime issued_at
        enum status "pending, paid, failed"
    }

    Payment {
        string id PK
        string invoice_id FK
        decimal amount
        datetime paid_at
    }

    Notification {
        string id PK
        string user_id FK
        string template_id FK
        string recipient_name
        string recipient_email
        string subject
        string message
        json data
        datetime created_at
        datetime updated_at
        enum status "pending, read, sent, failed"
    }

    EntryLog {
        string id PK
        string level "info, warning, error"
        string message
        datetime timestamp
        json data
    }

    JobQueue {
        string id PK
        enum job_type "launch_sync, booking_sync"
        string source_id
        enum status "pending, running, completed, failed"
        datetime created_at
        datetime executed_at
        json data
    }

    User ||--o| Traveler : "is a"
    User ||--o| Agency : "is a"
    User ||--o{ Notification : receives
    Agency ||--|{ Rocket : owns
    Agency ||--|{ Launch : schedules
    Agency ||--o{ Invoice : "is billed by"
    Rocket ||--o{ Launch : "is used in"
    Launch ||--o{ Booking : has
    Launch ||--o| Invoice : generates
    Traveler ||--o{ Booking : makes
    Invoice ||--o{ Payment : "is paid by"
```

---

## [ðŸš€ AstroBookings](https://github.com/AstroBookings)
